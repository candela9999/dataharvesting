<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.3.71">
  <meta name="author" content="Jorge Cimentada">
  <title>Case study: Scraping Spanish school locations from the web</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="case_study_spanish_schools_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="case_study_spanish_schools_files/libs/revealjs/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="case_study_spanish_schools_files/libs/revealjs/dist/theme/quarto.css" id="theme">

  <script src="case_study_spanish_schools_files/libs/clipboard/clipboard.min.js"></script>
  <script src="case_study_spanish_schools_files/libs/quarto-html/tabby.min.js"></script>
  <script src="case_study_spanish_schools_files/libs/quarto-html/popper.min.js"></script>
  <script src="case_study_spanish_schools_files/libs/quarto-html/tippy.umd.min.js"></script>
  <link href="case_study_spanish_schools_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="case_study_spanish_schools_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.7em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > :last-child,
  .callout.callout-captioned .callout-body > div > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal #title-slide.center,
    .reveal .title-slide.center,
    .reveal .controls .navigate-left .controls-arrow,
    .reveal .controls .navigate-right .controls-arrow {
      margin-top: -15px;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Case study: Scraping Spanish school locations from the web</h1>
  <p class="author">Jorge Cimentada</p>
</section>

<section class="slide level2">

<div class="cell">

</div>
</section>
<section id="case-study-scraping-spanish-school-locations-from-the-web" class="slide level2">
<h2>Case study: Scraping Spanish school locations from the web</h2>
<p>Goal:</p>

<img data-src="images/spain-map-schools-1.png" class="r-stretch quarto-figure-center"></section>
<section id="scraping-spanish-school-locations" class="slide level2">
<h2>Scraping Spanish school locations</h2>
<p><code>www.buscocolegio.com</code> is saved locally on the <code>scrapex</code> package in the function <code>spanish_schools_ex()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(scrapex)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">head</span>(<span class="fu">spanish_schools_ex</span>(), <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "/home/runner/.local/share/renv/cache/v5/R-4.2/x86_64-pc-linux-gnu/scrapex/0.0.1.9999/9aa78cbb3eccaaa811756b4bf07fdd1a/scrapex/extdata/spanish_schools_ex/school_15012626.html"
[2] "/home/runner/.local/share/renv/cache/v5/R-4.2/x86_64-pc-linux-gnu/scrapex/0.0.1.9999/9aa78cbb3eccaaa811756b4bf07fdd1a/scrapex/extdata/spanish_schools_ex/school_15013308.html"
[3] "/home/runner/.local/share/renv/cache/v5/R-4.2/x86_64-pc-linux-gnu/scrapex/0.0.1.9999/9aa78cbb3eccaaa811756b4bf07fdd1a/scrapex/extdata/spanish_schools_ex/school_2009122.html" </code></pre>
</div>
</div>
<p>These are the links to the landing page of each school inside the website. There are 27 schools saved locally.</p>
</section>
<section id="scraping-spanish-school-locations-1" class="slide level2">
<h2>Scraping Spanish school locations</h2>
<p>Let’s see how one school website looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(httr)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">library</span>(scrapex)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>school_links <span class="ot">&lt;-</span> <span class="fu">spanish_schools_ex</span>()</span>
<span id="cb3-9"><a href="#cb3-9"></a>school_url <span class="ot">&lt;-</span> school_links[<span class="dv">13</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">browseURL</span>(<span class="fu">prep_browser</span>(school_url))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scraping-spanish-school-locations-2" class="slide level2">
<h2>Scraping Spanish school locations</h2>

<img data-src="images/main_website_no_selection-01.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>Read it into R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>school_raw <span class="ot">&lt;-</span> <span class="fu">read_html</span>(school_url) <span class="sc">%&gt;%</span> <span class="fu">xml_child</span>()</span>
<span id="cb5-2"><a href="#cb5-2"></a>school_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{html_node}
&lt;head&gt;
 [1] &lt;title&gt;Aquí encontrarás toda la información necesaria sobre CEIP SANCHIS ...
 [2] &lt;meta charset="utf-8"&gt;\n
 [3] &lt;meta name="viewport" content="width=device-width, initial-scale=1, shri ...
 [4] &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;\n
 [5] &lt;meta name="author" content="BuscoColegio"&gt;\n
 [6] &lt;meta name="description" content="Encuentra toda la información necesari ...
 [7] &lt;meta name="keywords" content="opiniones SANCHIS GUARNER, contacto SANCH ...
 [8] &lt;link rel="shortcut icon" href="/favicon.ico"&gt;\n
 [9] &lt;link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Sl ...
[10] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[11] &lt;link rel="stylesheet" href="/assets/vendor/icon-awesome/css/font-awesom ...
[12] &lt;link rel="stylesheet" href="/assets/vendor/icon-line/css/simple-line-ic ...
[13] &lt;link rel="stylesheet" href="/assets/vendor/icon-line-pro/style.css"&gt;\n
[14] &lt;link rel="stylesheet" href="/assets/vendor/icon-hs/style.css"&gt;\n
[15] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[16] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[17] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[18] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[19] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
[20] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
...</code></pre>
</div>
</div>
</section>
<section id="build-a-scraper-for-one-school-1" class="slide level2">
<h2>Build a scraper for one school</h2>
<ul>
<li><p>Objective: extract school locations.</p></li>
<li><p>You always want to begin by browsing the source code on your browser</p></li>
<li><p>Exploring the output of <code>read_html</code> is not the best way to explore what you’re looking for</p></li>
<li><p>Get very familiar with the website. Scraping two websites will require vastly different strategies.</p></li>
<li><p>We’ll use the developers tool from your browser: <code>CTRL + SHIFT + c</code></p></li>
</ul>
</section>
<section id="build-a-scraper-for-one-school-2" class="slide level2">
<h2>Build a scraper for one school</h2>

<img data-src="images/developer_tools.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-3" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>This is like an open book. You need to search and explore what you’re looking for. This is unstructured in nature. First intuition: look for the source code close to the map:</p>

<img data-src="images/main_page.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-4" class="slide level2">
<h2>Build a scraper for one school</h2>
<p><code>CTRL + F</code> will pop up a search bar as other browsers. Search for terms next to what you’re looking for:</p>

<img data-src="images/search_developer_tools.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-5" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>Fast track to what we’re looking for:</p>

<img data-src="images/location_tag_zoomed.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-6" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>Remember, we’re just looking at the source code of the maps section:</p>

<img data-src="images/main_page.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-7" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>In case you didn’t know, the coordinates are hidden in a string inside the <code>href</code> tag:</p>

<img data-src="images/location_tag_zoomed.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-8" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>Typical brain storming:</p>
<ol type="1">
<li>Extract a unique tag?</li>
<li>Extract a common tag but with a unique attribute?</li>
<li>Extract a common tag but filtering through the ascendants of that tag?</li>
<li>Extract only filtering by text of an attribute, regardless of the tag?</li>
</ol>
<p><strong>There are many different ways to get what you’re looking for. XPath is very handy for this</strong> 👏.</p>
</section>
<section id="build-a-scraper-for-one-school-9" class="slide level2">
<h2>Build a scraper for one school</h2>
<p>We’ll go with option 3:</p>

<img data-src="images/father_p_tag.png" class="r-stretch quarto-figure-center"></section>
<section id="build-a-scraper-for-one-school-10" class="slide level2">
<h2>Build a scraper for one school</h2>
<ul>
<li><p>Tag <code>&lt;p&gt;</code> with a descendant <code>&lt;a&gt;</code> will return too many results</p></li>
<li><p>We can combine option 3 with option 2: Tag <code>&lt;p&gt;</code> with a unique text attribute with a descendant <code>&lt;a&gt;</code>.</p></li>
<li><p>Possible XPath: find all <code>p</code> tags with <code>class</code> set to <code>d-flex align-items-baseline g-mt-5</code>. If we get one match, we’re on the right track:</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Search for all &lt;p&gt; tags with that class in the document</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>school_raw <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;p class="d-flex align-items-baseline g-mt-5"&gt;\r\n\t                    &lt; ...</code></pre>
</div>
</div>
</section>
<section id="build-a-scraper-for-one-school-11" class="slide level2">
<h2>Build a scraper for one school</h2>
<ul>
<li><p>Extend XPath to say: find all <code>a</code> tags which are children of a <code>p</code> tag with <code>class</code> set to <code>d-flex align-items-baseline g-mt-5</code>.</p></li>
<li><p>Or in other words: append <code>//a</code> to the previous XPath</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Search for all &lt;p&gt; tags with that class in the document</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>school_raw <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;a href="/Colegio/buscar-colegios-cercanos.action?colegio.latitud=38.8274 ...</code></pre>
</div>
</div>
<p>There we are, we can see the coordinates 👏</p>
</section>
<section id="build-a-scraper-for-one-school-12" class="slide level2">
<h2>Build a scraper for one school</h2>
<ul>
<li><p>Extract <code>href</code> attribute with <code>xml_attr</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>location_str <span class="ot">&lt;-</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  school_raw <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">xml_attr</span>(<span class="at">attr =</span> <span class="st">"href"</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>location_str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "/Colegio/buscar-colegios-cercanos.action?colegio.latitud=38.8274492&amp;colegio.longitud=0.0221681"</code></pre>
</div>
</div></li>
</ul>
<p>Awesome, but now we need some ninja string skills to extract the coordinates.</p>
</section>
<section id="data-cleaning" class="slide level2">
<h2>Data Cleaning</h2>
<p>We need some regex skills to extract this. Let’s brain storming:</p>
<ol type="1">
<li>First coordinate appears after the first <code>=</code></li>
<li>There’s a few words like ‘colegio’ (this is just Spanish for school) and ‘longitud’ that are in the middle of the two coordinates.</li>
<li>A s<em>ingle</em> regex need not do all the work. Do it one step at a time.</li>
<li>One first step would be: extract any text after the <code>=</code> until the end of the string</li>
</ol>
</section>
<section id="data-cleaning-1" class="slide level2">
<h2>Data Cleaning</h2>
<p>Possible regex: <code>"=.+$"</code> which captures a <code>=</code> followed by any character (the <code>.</code>) repeated 1 or more times (<code>+</code>) until the end of the string (<code>$</code>). Let’s test it:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>location <span class="ot">&lt;-</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  location_str <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">str_extract_all</span>(<span class="st">"=.+$"</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>location</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[[1]]
[1] "=38.8274492&amp;colegio.longitud=0.0221681"</code></pre>
</div>
</div>
<p>There we go!</p>
</section>
<section id="data-cleaning-2" class="slide level2">
<h2>Data Cleaning</h2>
<p>Now we need to replace all unwanted letters in the strings. One way would be to say:</p>
<ul>
<li><p>Replace the <code>=</code> or <code>colegio.longitud</code> with an empty string.</p></li>
<li><p>Why not replace the <code>&amp;</code> as well? Because we can split the string based on <code>&amp;</code> later</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>location <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  location <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">str_replace_all</span>(<span class="st">"=|colegio</span><span class="sc">\\</span><span class="st">.longitud"</span>, <span class="st">""</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>location</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "38.8274492&amp;0.0221681"</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-3" class="slide level2">
<h2>Data Cleaning</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>location <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  location <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">str_split</span>(<span class="st">"&amp;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  .[[<span class="dv">1</span>]]</span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a>location</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "38.8274492" "0.0221681" </code></pre>
</div>
</div>
<p>Great, that’s it, this is data we’ve looking for in the entire chapter. Let’s summarize the work so far:</p>
<ul>
<li><p>Using XPath to extract tags that match our data</p></li>
<li><p>Clean up the data with some regex</p></li>
<li><p>Only do this for a <em>single</em> school since it’s much easier</p></li>
</ul>
</section>
<section id="scaling-the-scraper-to-all-schools" class="slide level2">
<h2>Scaling the scraper to all schools</h2>
<ul>
<li><p>When scraping repetitively similar pages, it always makes sense to start small.</p></li>
<li><p>Focus your efforts on a single school</p></li>
<li><p>Wrap all your work into a function that works for that single school</p></li>
<li><p>Loop over all other schools applying the tested function</p></li>
<li><p>Set your <code>User-Agent</code> to identify yourself</p></li>
</ul>
</section>
<section id="scaling-the-scraper-to-all-schools-1" class="slide level2">
<h2>Scaling the scraper to all schools</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># This sets your `User-Agent` globally so that all requests are identified with this `User-Agent`</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">set_config</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">user_agent</span>(<span class="st">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:105.0) Gecko/20100101 Firefox/105.0; Jorge Cimentada / cimentadaj@gmail.com"</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># Collapse all of the code from above into one function called</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># school grabber</span></span>
<span id="cb19-8"><a href="#cb19-8"></a></span>
<span id="cb19-9"><a href="#cb19-9"></a>school_grabber <span class="ot">&lt;-</span> <span class="cf">function</span>(school_url) {</span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="co"># We add a time sleep of 5 seconds to avoid</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="co"># sending too many quick requests to the website</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>  school_raw <span class="ot">&lt;-</span> <span class="fu">read_html</span>(school_url) <span class="sc">%&gt;%</span> <span class="fu">xml_child</span>()</span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a>  location_str <span class="ot">&lt;-</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>    school_raw <span class="sc">%&gt;%</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>    <span class="fu">xml_find_all</span>(<span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="fu">xml_attr</span>(<span class="at">attr =</span> <span class="st">"href"</span>)</span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a>  location <span class="ot">&lt;-</span></span>
<span id="cb19-22"><a href="#cb19-22"></a>    location_str <span class="sc">%&gt;%</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>    <span class="fu">str_extract_all</span>(<span class="st">"=.+$"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-24"><a href="#cb19-24"></a>    <span class="fu">str_replace_all</span>(<span class="st">"=|colegio</span><span class="sc">\\</span><span class="st">.longitud"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25"></a>    <span class="fu">str_split</span>(<span class="st">"&amp;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-26"><a href="#cb19-26"></a>    .[[<span class="dv">1</span>]]</span>
<span id="cb19-27"><a href="#cb19-27"></a></span>
<span id="cb19-28"><a href="#cb19-28"></a>  <span class="co"># Turn into a data frame</span></span>
<span id="cb19-29"><a href="#cb19-29"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb19-30"><a href="#cb19-30"></a>    <span class="at">latitude =</span> location[<span class="dv">1</span>],</span>
<span id="cb19-31"><a href="#cb19-31"></a>    <span class="at">longitude =</span> location[<span class="dv">2</span>],</span>
<span id="cb19-32"><a href="#cb19-32"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb19-33"><a href="#cb19-33"></a>  )</span>
<span id="cb19-34"><a href="#cb19-34"></a>}</span>
<span id="cb19-35"><a href="#cb19-35"></a></span>
<span id="cb19-36"><a href="#cb19-36"></a><span class="fu">school_grabber</span>(school_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>    latitude longitude
1 38.8274492 0.0221681</code></pre>
</div>
</div>
</section>
<section id="scaling-the-scraper-to-all-schools-2" class="slide level2">
<h2>Scaling the scraper to all schools</h2>
<p>Works for a single school, let’s loop over all other schools:</p>
<div class="cell" data-layout-align="center" data-hash="case_study_spanish_schools_cache/revealjs/unnamed-chunk-13_ea14cc8347f383740ac02c6cfcabc830">
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(school_links, school_grabber)</span>
<span id="cb21-2"><a href="#cb21-2"></a>coordinates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>     latitude  longitude
1  42.7277870 -8.6567935
2  43.2443899 -8.8921645
3  38.9559234 -1.2255769
4  39.1865665 -1.6225903
5  40.3824530 -3.6410388
6  40.2292912 -3.1106322
7  40.4385997 -3.6970366
8  40.3351393 -3.5155669
9  40.5054637 -3.3738441
10 40.6382608 -3.4537107
11 40.3854323 -3.6639500
12 37.7648471 -1.5030467
13 38.8274492  0.0221681
14 40.9943370 -5.6224391
15 40.9943370 -5.6224391
16 40.5603732 -5.6703725
17 40.9943370 -5.6224391
18 40.9943370 -5.6224391
19 41.1359296  0.9901905
20 41.2615548  1.1670507
21 41.2285137  0.5461471
22 41.1458017  0.8199749
23 41.1834060  0.5680564
24 42.0781977  1.8203155
25 42.2524468  1.8621546
26 41.7376665  1.8383666
27 41.6234490  2.0013628</code></pre>
</div>
</div>
</section>
<section id="plotting-all-schools" class="slide level2">
<h2>Plotting all schools</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">mutate_all</span>(coordinates, as.numeric)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>sp_sf <span class="ot">&lt;-</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"large"</span>, <span class="at">country =</span> <span class="st">"Spain"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">ggplot</span>(sp_sf) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> coordinates, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude)) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">10</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sample of schools in Spain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-all-schools-1" class="slide level2">
<h2>Plotting all schools</h2>

<img data-src="case_study_spanish_schools_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="scraping-publicprivate-school" class="slide level2">
<h2>Scraping public/private school</h2>
<ul>
<li><p>Private/public school info can help understand inequality.</p></li>
<li><p>Mapping school location to average income at the neighborhood level</p></li>
<li><p>Correlating private/public school quotas with income can understand inequality patterns</p></li>
<li><p>Luckily, the website has the info for us</p></li>
</ul>
</section>
<section id="scraping-publicprivate-school-1" class="slide level2">
<h2>Scraping public/private school</h2>

<p><strong>“Centro Público” means Public School</strong></p>
<img data-src="images/main_website_public_private-01.png" class="r-stretch quarto-figure-center"></section>
<section id="scraping-publicprivate-school-2" class="slide level2">
<h2>Scraping public/private school</h2>
<p>Open up developer tools (<code>CTRL + SHIFT + c</code>) and hover over that info:</p>

<img data-src="images/tag_public_private.png" class="r-stretch quarto-figure-center"></section>
<section id="scraping-publicprivate-school-3" class="slide level2">
<h2>Scraping public/private school</h2>
<p>Brainstorming scraping strategy:</p>
<ul>
<li><p>Info we want is within a <code>&lt;strong&gt;</code> tag</p></li>
<li><p><code>&lt;strong&gt;</code> is <strong>bold</strong> in HTML world</p></li>
<li><p>Too many matches if search for <code>&lt;strong&gt;</code></p></li>
<li><p>Find an ascendant with a unique attribute. For example: <code>&lt;div&gt;</code> tag with class <code>'col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25'</code></p></li>
</ul>
<p>Let’s try it.</p>
</section>
<section id="scraping-publicprivate-school-4" class="slide level2">
<h2>Scraping public/private school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>school_raw <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{xml_nodeset (10)}
 [1] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [2] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [3] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [4] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [5] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [6] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [7] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [8] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [9] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
[10] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...</code></pre>
</div>
</div>
<p>What? 10 matches? I was expecting one match..</p>
</section>
<section id="scraping-publicprivate-school-5" class="slide level2">
<h2>Scraping public/private school</h2>

<img data-src="images/main_website_details_box.png" class="r-stretch quarto-figure-center"></section>
<section id="scraping-publicprivate-school-6" class="slide level2">
<h2>Scraping public/private school</h2>
<p>One strategy is to extract content in all boxes and then extract the specific data we want:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>text_boxes <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  school_raw <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']//strong"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">xml_text</span>()</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a>text_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> [1] "616522706"                                                         
 [2] "966428835"                                                         
 [3] "03006839@edu.gva.es"                                               
 [4] "-"                                                                 
 [5] "966428836"                                                         
 [6] "3006839"                                                           
 [7] "Centro Público"                                                    
 [8] "Colegio de Educación Infantil y Primaria"                          
 [9] "GENERALITAT VALENCIANA"                                            
[10] "Vuelta al cole, inicio y fin de clases, vacaciones y días festivos"</code></pre>
</div>
</div>
</section>
<section id="scraping-publicprivate-school-7" class="slide level2">
<h2>Scraping public/private school</h2>
<ul>
<li><p>We don’t know if all schools will have exactly 10 boxes</p></li>
<li><p>Make it more precise with regex</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>single_public_private <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  text_boxes <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">str_detect</span>(<span class="st">"Centro"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  text_boxes[.]</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a>single_public_private</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Centro Público"</code></pre>
</div>
</div>
</section>
<section id="scraping-publicprivate-school-8" class="slide level2">
<h2>Scraping public/private school</h2>
<p>Same strategy: apply it to one school and scale it to all others:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>grab_public_private_school <span class="ot">&lt;-</span> <span class="cf">function</span>(school_link) {</span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>  school <span class="ot">&lt;-</span> <span class="fu">read_html</span>(school_link)</span>
<span id="cb30-4"><a href="#cb30-4"></a>  text_boxes <span class="ot">&lt;-</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>    school <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="fu">xml_find_all</span>(<span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']//strong"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="fu">xml_text</span>()</span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a>  single_public_private <span class="ot">&lt;-</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>    text_boxes <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="fu">str_detect</span>(<span class="st">"Centro"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>    text_boxes[.]</span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a></span>
<span id="cb30-15"><a href="#cb30-15"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="at">public_private =</span> single_public_private,</span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>  )</span>
<span id="cb30-19"><a href="#cb30-19"></a>}</span>
<span id="cb30-20"><a href="#cb30-20"></a></span>
<span id="cb30-21"><a href="#cb30-21"></a>public_private_schools <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(school_links, grab_public_private_school)</span>
<span id="cb30-22"><a href="#cb30-22"></a>public_private_schools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scraping-publicprivate-school-9" class="slide level2">
<h2>Scraping public/private school</h2>
<div class="cell" data-layout-align="center" data-hash="case_study_spanish_schools_cache/revealjs/unnamed-chunk-20_d4719f24f9783f61faacf11877d9d584">
<div class="cell-output-stdout">
<pre><code>   public_private
1  Centro Privado
2  Centro Público
3  Centro Público
4  Centro Público
5  Centro Privado
6  Centro Público
7  Centro Público
8  Centro Privado
9  Centro Público
10 Centro Público
11 Centro Público
12 Centro Público
13 Centro Público
14 Centro Público
15 Centro Público
16 Centro Público
17 Centro Público
18 Centro Privado
19 Centro Público
20 Centro Público
21 Centro Privado
22 Centro Público
23 Centro Privado
24 Centro Público
25 Centro Público
26 Centro Privado
27 Centro Público</code></pre>
</div>
</div>
</section>
<section id="scraping-publicprivate-school-10" class="slide level2">
<h2>Scraping public/private school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Let's translate the public/private names from Spanish to English</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>lookup <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Centro Público"</span> <span class="ot">=</span> <span class="st">"Public"</span>, <span class="st">"Centro Privado"</span> <span class="ot">=</span> <span class="st">"Private"</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a>public_private_schools<span class="sc">$</span>public_private <span class="ot">&lt;-</span> lookup[public_private_schools<span class="sc">$</span>public_private]</span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co"># Merge it with the coordinates data</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>all_schools <span class="ot">&lt;-</span> <span class="fu">cbind</span>(coordinates, public_private_schools)</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co"># Plot private/public by coordinates</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="fu">ggplot</span>(sp_sf) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> all_schools, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> public_private)) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">10</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sample of schools in Spain by private/public"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scraping-publicprivate-school-11" class="slide level2">
<h2>Scraping public/private school</h2>

<img data-src="case_study_spanish_schools_files/figure-revealjs/unnamed-chunk-22-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="extracting-type-of-school" class="slide level2">
<h2>Extracting type of school</h2>
<p>One additional information that might also be useful to know is the type of each school: kindergarten, secondary school, primary school, etc. This information is just next to whether the school is private or public:</p>

<img data-src="images/main_website_type_school.png" class="r-stretch quarto-figure-center"></section>
<section id="extracting-type-of-school-1" class="slide level2">
<h2>Extracting type of school</h2>
<p>Brain storm:</p>
<ul>
<li><p>This is the exact same code as before?</p></li>
<li><p>Can we recycle at least until extracting the <code>div</code> XPath?</p></li>
<li><p>Problem: we can’t know in advance the <em>type</em> of center so we can’t regex to detect it</p></li>
<li><p>Instead: detect <code>Tipo Centro</code>, genetic for “Type of center”</p></li>
</ul>
</section>
<section id="extracting-type-of-school-2" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>text_boxes <span class="ot">&lt;-</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  school_raw <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a>text_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{xml_nodeset (10)}
 [1] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [2] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [3] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [4] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [5] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [6] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [7] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [8] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
 [9] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
[10] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...</code></pre>
</div>
</div>
<p>10 boxes of the page</p>
</section>
<section id="extracting-type-of-school-3" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>selected_node <span class="ot">&lt;-</span> text_boxes <span class="sc">%&gt;%</span> <span class="fu">xml_text</span>() <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">"Tipo Centro"</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>selected_node</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE</code></pre>
</div>
</div>
<ul>
<li><p>Subset that node and from here on we can do as we did last time: extract the strong tag.</p></li>
<li><p>XPath <code>.//strong</code>. <code>.//strong</code> means to find all strong tags but the <code>.</code> means to search for all tags below the current selection.</p></li>
</ul>
</section>
<section id="extracting-type-of-school-4" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>single_type_school <span class="ot">&lt;-</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  text_boxes[selected_node] <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">xml_find_all</span>(<span class="st">".//strong"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">xml_text</span>()</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a>single_type_school</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Colegio de Educación Infantil y Primaria"</code></pre>
</div>
</div>
</section>
<section id="extracting-type-of-school-5" class="slide level2">
<h2>Extracting type of school</h2>
<p>General strategy:</p>
<ol type="1">
<li>Recycle strategy of extracting all <code>div</code> tags</li>
<li>Can’t know in advance type of school. Search for generic wording in the box.</li>
<li>Extract the specific <code>div</code> node that matches the wording</li>
<li>Searching for the <code>strong</code> tag but <strong>only</strong> within that box with <code>.//strong</code>.</li>
</ol>
</section>
<section id="extracting-type-of-school-6" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>grab_type_school <span class="ot">&lt;-</span> <span class="cf">function</span>(school_link) {</span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb39-3"><a href="#cb39-3"></a>  school <span class="ot">&lt;-</span> <span class="fu">read_html</span>(school_link)</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a>  text_boxes <span class="ot">&lt;-</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>    school <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>    <span class="fu">xml_find_all</span>(<span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span>)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>  selected_node <span class="ot">&lt;-</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>    text_boxes <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>    <span class="fu">xml_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12"></a>    <span class="fu">str_detect</span>(<span class="st">"Tipo Centro"</span>)</span>
<span id="cb39-13"><a href="#cb39-13"></a></span>
<span id="cb39-14"><a href="#cb39-14"></a>  single_type_school <span class="ot">&lt;-</span></span>
<span id="cb39-15"><a href="#cb39-15"></a>    text_boxes[selected_node] <span class="sc">%&gt;%</span></span>
<span id="cb39-16"><a href="#cb39-16"></a>    <span class="fu">xml_find_all</span>(<span class="st">".//strong"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-17"><a href="#cb39-17"></a>    <span class="fu">xml_text</span>()</span>
<span id="cb39-18"><a href="#cb39-18"></a></span>
<span id="cb39-19"><a href="#cb39-19"></a></span>
<span id="cb39-20"><a href="#cb39-20"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb39-21"><a href="#cb39-21"></a>    <span class="at">type_school =</span> single_type_school,</span>
<span id="cb39-22"><a href="#cb39-22"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb39-23"><a href="#cb39-23"></a>  )</span>
<span id="cb39-24"><a href="#cb39-24"></a>}</span>
<span id="cb39-25"><a href="#cb39-25"></a></span>
<span id="cb39-26"><a href="#cb39-26"></a>all_type_schools <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(school_links, grab_type_school)</span>
<span id="cb39-27"><a href="#cb39-27"></a>all_type_schools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-type-of-school-7" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center" data-hash="case_study_spanish_schools_cache/revealjs/unnamed-chunk-27_086120385e73334d392a588f9bce1ea2">
<div class="cell-output-stdout">
<pre><code>                                    type_school
1                              Escuela Infantil
2                              Escuela Infantil
3                              Escuela Infantil
4                              Escuela Infantil
5                              Escuela Infantil
6  Escuela de Educación Infantil, Casa de Niños
7                              Escuela Infantil
8                              Escuela Infantil
9                              Escuela Infantil
10 Escuela de Educación Infantil, Casa de Niños
11                             Escuela Infantil
12      Escuela Municipal de Educación Infantil
13     Colegio de Educación Infantil y Primaria
14                             Escuela Infantil
15                             Escuela Infantil
16                             Escuela Infantil
17                             Escuela Infantil
18                             Escuela Infantil
19                                       Escola
20                                       Escola
21                                       Escola
22                                       Escola
23                                       Escola
24                                       Escola
25                                       Escola
26                                       Escola
27                                       Escola</code></pre>
</div>
</div>
</section>
<section id="extracting-type-of-school-8" class="slide level2">
<h2>Extracting type of school</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource r cell-code number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>all_schools <span class="ot">&lt;-</span> <span class="fu">cbind</span>(all_schools, all_type_schools)</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="fu">ggplot</span>(sp_sf) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> all_schools, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> public_private)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">10</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type_school) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sample of schools in Spain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-type-of-school-9" class="slide level2">
<h2>Extracting type of school</h2>

<img data-src="case_study_spanish_schools_files/figure-revealjs/unnamed-chunk-29-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li><p>Web scraping is all about creativity</p></li>
<li><p>Knowing some XPath</p></li>
<li><p>Mastering some regex</p></li>
<li><p>Thinking outside the box</p></li>
</ul>
<p>🤯</p>
</section>
<section id="homework" class="slide level2">
<h2>Homework</h2>
<ul>
<li><p>Chapter 10 and 11 – read + exercises</p></li>
<li><p>Deadline for groups is today. Anyone missing? <a href="https://docs.google.com/spreadsheets/d/11QmdgRXvbwtN9hSOwVyw9-iVjrN-yeRq_BOudidAnX8/edit#gid=0">Here</a>.</p></li>
<li><p>Each group should send me an email with their project idea (other team members as cc) and I will advise on whether it's a good idea. Deadline is in <strong>two weeks.</strong></p></li>
</ul>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="case_study_spanish_schools_files/libs/revealjs/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="case_study_spanish_schools_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>


  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,

'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,

        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        setTimeout(function() {
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>