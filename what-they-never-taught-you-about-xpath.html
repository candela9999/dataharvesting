<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 What they never taught you about XPath | Data Harvesting with R</title>
<meta name="author" content="Jorge Cimentada">
<meta name="description" content="Primer on XPath xml_test &lt;- &quot;&lt;people&gt; &lt;jason&gt;  &lt;person type='fictional'&gt;   &lt;first_name&gt;    &lt;married&gt;     Jason    &lt;/married&gt;   &lt;/first_name&gt;   &lt;last_name&gt;     Bourne   &lt;/last_name&gt;   &lt;occupation&gt; ...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="6 What they never taught you about XPath | Data Harvesting with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://cimentadaj.github.io/dataharvesting/what-they-never-taught-you-about-xpath.html">
<meta property="og:description" content="Primer on XPath xml_test &lt;- &quot;&lt;people&gt; &lt;jason&gt;  &lt;person type='fictional'&gt;   &lt;first_name&gt;    &lt;married&gt;     Jason    &lt;/married&gt;   &lt;/first_name&gt;   &lt;last_name&gt;     Bourne   &lt;/last_name&gt;   &lt;occupation&gt; ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6 What they never taught you about XPath | Data Harvesting with R">
<meta name="twitter:description" content="Primer on XPath xml_test &lt;- &quot;&lt;people&gt; &lt;jason&gt;  &lt;person type='fictional'&gt;   &lt;first_name&gt;    &lt;married&gt;     Jason    &lt;/married&gt;   &lt;/first_name&gt;   &lt;last_name&gt;     Bourne   &lt;/last_name&gt;   &lt;occupation&gt; ...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Lato-0.4.1/font.css" rel="stylesheet">
<link href="libs/_Roboto%20Mono-0.4.1/font.css" rel="stylesheet">
<link href="libs/_Montserrat-0.4.1/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
   ga('create', 'UA-99618359-1', 'auto');
   ga('send', 'pageview');
  
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Data Harvesting with R</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="introduction-to-webscraping.html"><span class="header-section-number">2</span> Introduction to Webscraping</a></li>
<li><a class="" href="a-primer-on-webscraping.html"><span class="header-section-number">3</span> A primer on Webscraping</a></li>
<li><a class="" href="data-formats-for-webscraping.html"><span class="header-section-number">4</span> Data Formats for Webscraping</a></li>
<li><a class="" href="what-they-never-taught-you-about-regular-expressions.html"><span class="header-section-number">5</span> What they never taught you about regular expressions</a></li>
<li><a class="active" href="what-they-never-taught-you-about-xpath.html"><span class="header-section-number">6</span> What they never taught you about XPath</a></li>
<li><a class="" href="case-study-scraping-spanish-school-locations-from-the-web.html"><span class="header-section-number">7</span> Case study: scraping Spanish school locations from the web</a></li>
<li><a class="" href="automating-web-scraping-scripts.html"><span class="header-section-number">8</span> Automating Web scraping scripts</a></li>
<li><a class="" href="scraping-javascript-based-website.html"><span class="header-section-number">9</span> Scraping JavaScript based website</a></li>
<li><a class="" href="ethical-issues-in-web-scraping.html"><span class="header-section-number">10</span> Ethical issues in Web Scraping</a></li>
<li><a class="" href="introduction-to-rest-apis.html"><span class="header-section-number">11</span> Introduction to REST APIs</a></li>
<li><a class="" href="introduction-to-json.html"><span class="header-section-number">12</span> Introduction to JSON</a></li>
<li><a class="" href="a-primer-on-apis.html"><span class="header-section-number">13</span> A primer on APIs</a></li>
<li><a class="" href="what-is-a-restful-api.html"><span class="header-section-number">14</span> What is a RESTful API?</a></li>
<li><a class="" href="authentication-in-apis.html"><span class="header-section-number">15</span> Authentication in APIs</a></li>
<li><a class="" href="case-study-grabbing-data-from-a-public-api.html"><span class="header-section-number">16</span> Case Study: grabbing data from a public API</a></li>
<li><a class="" href="why-automation-is-important.html"><span class="header-section-number">17</span> Why automation is important</a></li>
<li><a class="" href="automating-data-collectiong-programs.html"><span class="header-section-number">18</span> Automating data collectiong programs</a></li>
<li><a class="" href="insightful-and-robust-data-collection-progams.html"><span class="header-section-number">19</span> Insightful and robust data collection progams</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/cimentadaj/dataharvesting/tree/main/book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="what-they-never-taught-you-about-xpath" class="section level1">
<h1>
<span class="header-section-number">6</span> What they never taught you about XPath<a class="anchor" aria-label="anchor" href="#what-they-never-taught-you-about-xpath"><i class="fas fa-link"></i></a>
</h1>
<p>Primer on XPath</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xml_test</span> <span class="op">&lt;-</span> <span class="st">"&lt;people&gt;
&lt;jason&gt;
  &lt;person type='fictional'&gt;
    &lt;first_name&gt;
      &lt;married&gt;
        Jason
      &lt;/married&gt;
    &lt;/first_name&gt;
    &lt;last_name&gt;
        Bourne
    &lt;/last_name&gt;
    &lt;occupation&gt;
      Spy
    &lt;/occupation&gt;
  &lt;/person&gt;
&lt;/jason&gt;
&lt;carol&gt;
  &lt;person type='real'&gt;
    &lt;first_name&gt;
      &lt;married&gt;
        Carol
      &lt;/married&gt;
    &lt;/first_name&gt;
    &lt;last_name&gt;
        Kalp
    &lt;/last_name&gt;
    &lt;occupation&gt;
      Scientist
    &lt;/occupation&gt;
  &lt;/person&gt;
&lt;/carol&gt;
&lt;/people&gt;
"</span>

<span class="va">xml_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="va">xml_test</span><span class="op">)</span></code></pre></div>
<p>To extract all the tags in a document, we can use <code>//name_of_tag</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Search for all 'married' nodes</span>
<span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">xml_raw</span>, <span class="st">"//married"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (2)}
## [1] &lt;married&gt;\n        Jason\n      &lt;/married&gt;
## [2] &lt;married&gt;\n        Carol\n      &lt;/married&gt;</code></pre>
<p>With the previous XPath, we’re searching for <strong>all</strong> married tags within the complete XML tree. The result returns all married nodes (I use the words tags and nodes interchangeably) in the complete tree structure. Another example would be finding all <code>&lt;occupation&gt;</code> tags:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">xml_raw</span>, <span class="st">"//occupation"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (2)}
## [1] &lt;occupation&gt;\n      Spy\n    &lt;/occupation&gt;
## [2] &lt;occupation&gt;\n      Scientist\n    &lt;/occupation&gt;</code></pre>
<p>If you want to find any other tag you can replace <code>"//occupation"</code> with your tag of interest and <code>xml_find_all</code> will find all of them.</p>
<p>If you wanted to find all tags <strong>below</strong> your current node, you only need to add a <code>.</code> at the beginning: <code>".//occupation"</code>. For example, if we dived into the <code>&lt;jason&gt;</code> tag and we wanted his <code>&lt;occupation&gt;</code> tag, <code>"//occupation"</code> will returns <strong>all</strong> <code>&lt;occupation&gt;</code> tags. Instead, <code>".//occupation"</code> will return only the found tags <strong>below</strong> the current tag. For example:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xml_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># Dive only into Jason's tag</span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">".//occupation"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;occupation&gt;\n      Spy\n    &lt;/occupation&gt;</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Instead, the wrong way would have been:</span>
<span class="va">xml_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># Dive only into Jason's tag</span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># Here we get both occupation tags</span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//occupation"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (2)}
## [1] &lt;occupation&gt;\n      Spy\n    &lt;/occupation&gt;
## [2] &lt;occupation&gt;\n      Scientist\n    &lt;/occupation&gt;</code></pre>
<p>The first example only returns <code>&lt;jason&gt;</code>’s occupation whereas the second returned <strong>all</strong> occupations, regardless of where you are in the tree.</p>
<p>XPath also allows you to identify tags that contain only one specific <strong>attribute</strong>, such as the one’s we saw earlier. For example, to filter all <code>&lt;person&gt;</code> tags with the attribute <code>filter</code> set to <code>fictional</code>, we could do it with:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Give me all the tags 'person' that have an attribute type='fictional'</span>
<span class="va">xml_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//person[@type='fictional']"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;person type="fictional"&gt;\n  &lt;first_name&gt;\n    &lt;married&gt;\n        Jason\n ...</code></pre>
<p>If you wanted to do the same but for the tags <strong>below</strong> your current nodes, the same trick we learned earlier would work: <code>".//person[@type='fictional']"</code>. These are just some primers that can help you jump easily to using XPath, but I encourage you to look at other examples on the web, as complex websites often require complex XPath expressions.</p>
<p>Before we begin our real-word example, you might be asking yourself how you can actually <strong>extract</strong> the text/numeric data from these <strong>nodes</strong>. Well, that’s easy: <code>xml_text</code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xml_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">".//occupation"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "\n      Spy\n    "       "\n      Scientist\n    "</code></pre>
<p>Once you’ve narrowed down your tree-based search to one single piece of text or numbers, <code><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text()</a></code> will extract that for you (there’s also <code>xml_double</code> and <code>xml_integer</code> for extracting numbers). As I said, XPath is really a huge language. If you’re interested, <a href="https://devhints.io/xpath">this</a> XPath cheat sheets have helped me a lot to learn tricks for easy scraping.</p>
<div id="exercises-1" class="section level2">
<h2>
<span class="header-section-number">6.1</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-1"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="what-they-never-taught-you-about-regular-expressions.html"><span class="header-section-number">5</span> What they never taught you about regular expressions</a></div>
<div class="next"><a href="case-study-scraping-spanish-school-locations-from-the-web.html"><span class="header-section-number">7</span> Case study: scraping Spanish school locations from the web</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-they-never-taught-you-about-xpath"><span class="header-section-number">6</span> What they never taught you about XPath</a></li>
<li><a class="nav-link" href="#exercises-1"><span class="header-section-number">6.1</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/cimentadaj/dataharvesting/tree/main/book/blob/main/05-xpath.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/cimentadaj/dataharvesting/tree/main/book/edit/main/05-xpath.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Harvesting with R</strong>" was written by Jorge Cimentada. It was last built on 2022-09-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
